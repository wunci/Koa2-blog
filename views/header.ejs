<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>koa2-blog</title>
    <link rel="stylesheet" href="/stylesheets/style.css">
    <script src="https://unpkg.com/jquery@3.3.1/dist/jquery.min.js"></script>
    <% if(session.user){ %>
    <script type="text/javascript" charset="utf-8" src="/ueditor/ueditor.config.js"></script>
    <script type="text/javascript" charset="utf-8" src="/ueditor/ueditor.all.min.js"> </script>
    <script type="text/javascript" charset="utf-8" src="/ueditor/lang/zh-cn/zh-cn.js"> </script>
    <% } %>  
    <script>
        function fade(txt){
            $('.message').text(txt)
            $('.message').animate({
                top:0
            })
            setTimeout(function(){
                $('.message').animate({
                    top: '-100%'
                })
            },1500)
        }
        $(function(){
            $('.signout').click(function(){
                $.ajax({
                    url: "/signout",
                    type: "GET",
                    cache: false,
                    dataType: 'json',
                    success: function (msg) {
                        if (msg) {
                            fade('退出成功')
                            setTimeout(function(){
                                location.href = "/posts"
                            },1500) 
                        }
                    },
                    error: function () {
                        alert('异常');
                    }
                })
            })

            // $(".s-btn").click(function(){
            //     var keywords = $("#search-input").val();
            //     if(keywords!=""){
            //         location.href = "/search";

            //     } else {
            //         fade('请输入关键词进行搜索~')
            //     }
            // })

        })
    </script>
</head>
<body>
    <header>
                <% if(session.user){ %>
            <div class="user_name">
                <% }else{ %>
            <div class="unlogin user_name">
                <% } %>    
            
                <% if(session.user){ %>
                 <div class="fl userinfo">Hello,<%= session.user %></div>
                <% } %>
                <% if(!session.user){ %>
                 <div class="fl userinfo">欢迎注册登录^_^</div>
                <% } %>

                <% if(url.split('?')[0] == '/posts' || url.split('?')[0] =='/search') { %>
                <div class="fr search" >
                    <form action="/search">
                        <select name="type">
                            <option value="article" selected = "selected">文章</option>
                            <option value="users">会员</option>
                        </select>
                        <input type="text" name="keywords" value="" id="search-input">
                        <button type="submit" class="s-btn">搜索</button>
                    </form>
                    <!-- <a href="/search">搜索</a> -->
                </div>
                <% } %>
        </div>
        <div class="message">登录成功</div>
        <div class="user_right">
            <%  if(session.user){ %>
                <div class="has_user">
                    <% if(type == 'all'){ %>
                        <a class="active" href="/posts">全部文章</a>
                    <% }else{ %>
                        <a href="/posts">全部文章</a>
                    <% }%>
                    
                    <% if(type == 'userlist'){ %>
                        <a class="active" href="/userlist">会员列表</a>
                    <% }else{ %>
                        <a href="/userlist">会员列表</a>
                    <% }%>

                    <% if(type == 'my'){ %>
                        <a class="active" href="/posts?author=<%= session.user %>">我的文章</a>
                    <% }else{ %>
                        <a href="/posts?author=<%= session.user %>">我的文章</a>
                    <% }%>
                    <% if(type == 'create'){ %>
                        <a class="active" href="/create">发表文章</a>
                    <% }else{ %>
                        <a href="/create">发表文章</a>
                    <% }%>
                    
                    <span class="signout">退出</span>
                </div>
            <% } %>
            <% if(!session.user){ %>
                <div class="none_user has_user">
                    <% if(type == 'all'){ %>
                        <a class="active" href="/posts">全部文章</a>
                    <% }else{ %>
                        <a href="/posts">全部文章</a>
                    <% }%>
                    <% if(type == 'userlist'){ %>
                        <a class="active" href="/userlist">会员列表</a>
                    <% }else{ %>
                        <a href="/userlist">会员列表</a>
                    <% }%>
                    <% if(type == 'signup'){ %>
                        <a class="active" href="/signup">注册</a>
                    <% }else{ %>
                        <a href="/signup">注册</a>
                    <% }%>
                    <% if(type == 'signin'){ %>
                        <a class="active" href="/signin">登录</a>
                    <% }else{ %>
                        <a href="/signin">登录</a>
                    <% }%>
                </div>
            <% } %>
        </div>
    </header>